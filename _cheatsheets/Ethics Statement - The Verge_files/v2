


(function() {
    var amznAutoTagger=function(a){var c={};c.process=function(e){d(e,a.trackingId);};var b=["tag","tag-value","tag_value","t"];function d(h,e){var g=false;for(var f=0;f<b.length;f++){if(amznOneTagUtils.isQueryParamPresent(h,b[f])){g=true;break;}}if(!g){amznOneTagUtils.addQueryParam(h,"linkCode","w50");amznOneTagUtils.addQueryParam(h,"tag",e);}}return c;};
    var amznFetchImpression=function(c){var e={};var a=null;e.process=function(g){var i=new XMLHttpRequest();i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE){if(i.status===200&&i.responseText){var j=JSON.parse(i.responseText);b(j,g);}else{f(g);}}};var h=e.getImpressionRequestUrl(c);i.open("GET",h,true);i.timeout=c.impressionFetchTimeout;i.withCredentials=true;i.ontimeout=f;i.send();};function f(g){amznImpressionModel.init(null,null);d(g);}function b(h,g){amznImpressionModel.init(h.impressionId,h.impressionToken);d(g);}e.setNextStep=function(g){a=g;};function d(g){if(a){a(g);}}e.getImpressionRequestUrl=function(g){var i="/onetag";var h={};h.tracking_id=g.trackingId;h.region=g.region;h.slotNum=0;h.assocPayloadId=amznSessionStorage.get("assocPayloadId");h.refUrl=amznOneTagUtils.getCurrentUrl();h.pageTitle=document.title;var j="?src=330&sz=1x1&pj="+encodeURIComponent(JSON.stringify(h))+"&u="+amznOneTagUtils.getCurrentUrl();return g.aesEndpoint+i+j;};return e;};var amznTransitRecorder=function(b){var e={};var a=null;var d="assocPayloadId";e.process=function(i){if(amznImpressionModel.isUserOptedOut()){c(i);return false;}var h=amznImpressionModel.get();if(!(g())||f(amznOneTagUtils.getCurrentUrl())){amznSessionStorage.set(d,h.id);}c(i);return true;};function c(h){if(a){a(h);}}function f(i){var h=i.match(/utm_source=/i);return(h!==null);}function g(){var h=amznSessionStorage.get(d);return h;}e.setNextStep=function(h){a=h;};return e;};var amznImpressionAppender=function(a){var b={};b.process=function(c){if(amznImpressionModel.isUserOptedOut()){return false;}amznOneTagUtils.addQueryParam(c,"imprToken",amznImpressionModel.get().token);amznOneTagUtils.addQueryParam(c,"slotNum",amznLinkSlot.getSlot());return true;};return b;};var amznPixelRecorder=function(b){var d={};var a=null;d.process=function(g){if(amznImpressionModel.isUserOptedOut()){c(g);return false;}var h=d.createAssocPayload(g);var f=amznImpressionModel.get();var e=b.aesEndpoint+"/onetag/"+f.id+"/pixel?assoc_payload="+encodeURIComponent(h);d.generateImage(e);c(g);return true;};d.generateImage=function(e){if(e){(new Image()).src=e;}};d.createAssocPayload=function(f){var h={};h.refUrl=amznOneTagUtils.getCurrentUrl();h.assocPayloadId=amznSessionStorage.get("assocPayloadId");h.pageTitle=document.title;h.trackingId=b.trackingId;if(f.nodeName==="#document"){h.logType="onetag_pageload";h.linkCode="w49";}else{if(f.nodeName==="A"){var g=f.search.match(/(linkCode)=([^&]+)/i);h.logType="onetag_textlink";h.slotNum=amznLinkSlot.getSlot();h.destinationURL=f.href;if(g){h.linkCode="w50";}else{h.linkCode="w61";}}}var e=JSON.stringify(h);return e;};d.setNextStep=function(e){a=e;};function c(e){if(a){a(e);}}return d;};var amznImpressionModel=(function(){var b={};var a={};a.init=function(d,c){b.id=d;b.token=c;return b;};a.get=function(){if(Object.keys(b).length===0){b=a.init(null,null);}return b;};a.isUserOptedOut=function(){return(b.token===null||typeof b.token==="undefined");};return a;}());var amznSessionStorage=(function(){var a={};a.get=function(c){var d=null;if(typeof(window.sessionStorage)!=="undefined"){try{d=window.sessionStorage.getItem(c);}catch(b){}}return d;};a.set=function(c,d){if(typeof(window.sessionStorage)!=="undefined"){try{window.sessionStorage.setItem(c,d);}catch(b){}}};return a;}());
    var amznOneTagUtils=(function(){var b={};var a={CA:"ca",CN:"cn",IN:"in",DE:"de",FR:"fr",GB:"co.uk",JP:"co.jp",US:"com"};var d=["kdp.amazon.com"];var c="ots";b.fetchAmznLinks=function(j,e){var k=a[e];var l=new RegExp("^(http|https)://(www|[\\w\\-\\.]+)?amazon\\.("+k+")/","i");var h=j.getElementsByTagName("a");var g=[];for(i=0;i<h.length;i++){var f=String(h[i].href);if(f.match(l)&&!isAnExcludedLink(f)){g.push(h[i]);}}return g;};b.markLinkAsProcessed=function(e){if(b.isLinkProcessed(e)){return;}b.addQueryParam(e,c,"1");};b.isLinkProcessed=function(e){return e.search.indexOf("ots=1")!==-1;};b.addQueryParam=function(f,e,g){if(f.search.length===0){f.search=f.search.concat("?"+e+"="+g);}else{f.search=f.search.replace(/\?/,"?"+e+"="+g+"&");}};b.isQueryParamPresent=function(g,f){var e="/?"+f+"=([^&]+)|&"+f+"=([^&]+)/";return g.search.match(e);};b.getCurrentUrl=function(){return(window.location!==window.parent.location)?document.referrer:document.location.href;};isAnExcludedLink=function(g){var f,e=false;for(f=0;f<d.length;f++){if(g.match(d[f])){e=true;break;}}return e;};b.isTrackingEnabled=function(){return !window["aa-disable-onetag-tracking"];};return b;}());var amznLinkSlot=(function(){var a={};var b=-1;a.getSlot=function(){return b;};a.increment=function(){b++;};return a;}());var amznPageHandler=function(c){var e={};var b=[];var d=null;var a=function(){if(typeof amznFetchImpression!=="undefined"&&amznOneTagUtils.isTrackingEnabled()){b.push(amznFetchImpression(c));}if(typeof amznTransitRecorder!=="undefined"&&amznOneTagUtils.isTrackingEnabled()){b.push(amznTransitRecorder(c));}if(typeof amznPixelRecorder!=="undefined"&&amznOneTagUtils.isTrackingEnabled()){b.push(amznPixelRecorder(c));}var j=null;if(b.length){j=b[0];for(var h=1;h<b.length;h++){var f=b[h];var k=b[h-1];k.setNextStep(f.process);}var g=b[b.length-1];g.setNextStep(e.completed);}return j;};e.handleRequest=function(){var f=a();if(f){f.process(document);}else{e.completed();}};e.setNextHandler=function(f){d=f;};e.completed=function(){if(d){d();}};return e;};var amznLinkHandler=function(c){var e={};var d=null;var b=[];var a=function(f){if(typeof amznAutoTagger!=="undefined"){b.push(amznAutoTagger(c));}if(typeof amznPixelRecorder!=="undefined"&&amznOneTagUtils.isTrackingEnabled()){b.push(amznPixelRecorder(c));}if(typeof amznImpressionAppender!=="undefined"&&amznOneTagUtils.isTrackingEnabled()){b.push(amznImpressionAppender(c));}};e.handleRequest=function(){var g=amznOneTagUtils.fetchAmznLinks(document,c.region);if(b.length===0){a();}for(var f=0;f<g.length;f++){if(!amznOneTagUtils.isLinkProcessed(g[f])){amznLinkSlot.increment();b.forEach(function(h){h.process(g[f]);});amznOneTagUtils.markLinkAsProcessed(g[f]);}}e.completed();};e.setNextHandler=function(f){d=f;};e.completed=function(){if(d){d();}};return e;};var amznMutationRunner=function(h){var g={};var f=3000;var c={childList:true,subtree:true,chracterData:true};var e=document.body;var j,a;var d=false;function b(){a=Date.now();j=a;h.handleRequest();d=false;}g.process=function(){h.setNextHandler(null);j=Date.now();var k=new MutationObserver(function(l){a=Date.now();if(a-j>f){j=a;h.handleRequest();}else{if(!d){d=true;setTimeout(b,f);}}});k.observe(e,c);};return g;};var amznDynamicContentHandler=function(a){var c={};var b=null;c.handleRequest=function(){if(typeof amznMutationRunner!=="undefined"){amznMutationRunner(a).process();}c.completed();};c.setNextHandler=function(d){b=d;};c.completed=function(){if(b){b();}};return c;};var amznOneTag=function(a){var b={};b.execute=function(){var e=amznPageHandler(a);var c=amznLinkHandler(a);var d=amznDynamicContentHandler(c);c.setNextHandler(d.handleRequest);e.setNextHandler(c.handleRequest);e.handleRequest();};return b;};
var spec = {
trackingId : "curbedcom06-20",
region : "US",
aesEndpoint : "https://assoc-na.associates-amazon.com"
};
var onetag = amznOneTag(spec);
onetag.execute();
}());
