(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{531:function(e,t,i){"use strict";i.r(t);var n=i(480),a=i(19),o=i(61);var r=function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=t&&t.asset&&t.asset.chartbeat_account_id;if(!n)throw new Error("accountId is required");if(!i)throw new Error("youtubeVideoPlayer is required");var a,o,r=window._sf_async_config=window._sf_async_config||{};r.uid=n,r.domain=new URL(t.host.host.url).host,(window._cbv||(window._cbv=[])).push(i),a=document.createElement("script"),o=document.getElementsByTagName("script")[0],a.type="text/javascript",a.async=!0,a.src="//static.chartbeat.com/js/chartbeat_video.js",o.parentNode.insertBefore(a,o)},s=i(547);function u(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t,i){return(d="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}(e,t);if(n){var a=Object.getOwnPropertyDescriptor(n,t);return a.get?a.get.call(i):a.value}})(e,t,i||e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e,t){return!t||"object"!==typeof t&&"function"!==typeof t?h(e):t}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var f=[],v={2:"The request contains an invalid parameter value.",5:"The requested content cannot be played in an HTML5 player.",100:"The requested video was not found.",101:"The video owner does not allow it to be played in embedded players.",150:"The video owner does not allow it to be played in embedded players."},b=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(_,e);var t,i,n,b,w=(t=_,function(){var e,i=p(t);if(y()){var n=p(this).constructor;e=Reflect.construct(i,arguments,n)}else e=i.apply(this,arguments);return l(this,e)});function _(e,t){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,_),(i=w.call(this,e,t)).embedConfig="",i.videoIndex=0,i.resetState(),i.options=Object(o.b)({controls:1,modestbranding:1,rel:0,showInfo:0,timedEvents:{},start:t.params.start_time||0},t.params),i.options.autoplay=i.autoplayVideo,i.video.ytpp_enabled&&(i.embedConfig=JSON.stringify({autonavRelatedVideos:i.video.continuous_play_enabled,disableRelatedVideos:!i.video.continuous_play_enabled,relatedChannels:T(i.video.provider_class,i.video.youtube_channel),relatedVideos:i.video.continuous_play_enabled?i.video.youtube_playlist_ids:[]}),delete i.options.rel),i.asset.parsely_site_id&&(i.parsely=new s.a(h(i))),i}return i=_,(n=[{key:"load",value:function(){this.mark("YouTubeLoadTime"),this.api()?this.build():(window.onYouTubeIframeAPIReady||(window.onYouTubeIframeAPIReady=function(){return f.forEach((function(e){return e.build()}))},Object(o.d)("//www.youtube.com/iframe_api")),f.push(this))}},{key:"api",value:function(){return window.YT}},{key:"build",value:function(){var e=this;if(!this.player){var t=this.api();this.player=new t.Player(this.el.id,{videoId:this.video.youtube_id||this.video.provider_video_id,playerVars:this.options,embedConfig:this.embedConfig,events:{onReady:function(t){e.asset.chartbeat_account_id&&(e.chartbeat=new r(e,t.target)),e.trackTimeSinceMark(a.a.LOAD_TIME,"YouTubeLoadTime"),e.resetState(),e.el.addEventListener("playTimeUpdate",(function(){e.trackQuartiles(),e.trackThresholds()})),e.autoplayVideo&&e.onStart()},onStateChange:function(i){switch(i.data){case t.PlayerState.UNSTARTED:return e.onStart();case t.PlayerState.PLAYING:return e.onPlaying();case t.PlayerState.ENDED:return e.onEnded();case t.PlayerState.PAUSED:return e.onPaused()}},onError:function(t){e.track({action:a.a.ERROR,value:t.data,index:e.videoIndex,message:v[t.data]||"Unknown error."})}},width:"100%",height:"100%"})}}},{key:"resetState",value:function(){this.player&&(this.youtubeId=this.player.getVideoData().video_id),this.currentQuartile=0,this.watchedSeconds=0,this.currentThreshold=0,this.eventQueue=[],this.staleVideo=!1}},{key:"onStart",value:function(){this.firstPlayTriggered||0!==this.videoIndex||(this.mark("YouTubeTTFF"),this.firstPlayTriggered=!0,this.track({action:a.a.PLAY}))}},{key:"onPlaying",value:function(){this.pauseOtherPlayers(),this.timeStart(),this.played&&this.youtubeId!==this.player.getVideoData().video_id&&this.relatedVideoStart(),this.played||0!==this.videoIndex||(this.trackTimeSinceMark(a.a.TTFF,"YouTubeTTFF"),this.played=!0,this.track({action:a.a.START,value:this.duration(),index:this.videoIndex}))}},{key:"onEnded",value:function(){this.timeStop(),this.watchedSeconds=0,this.track({action:a.a.COMPLETE,value:Math.floor(.25*this.player.getDuration()),index:this.videoIndex})}},{key:"onPaused",value:function(){this.timeStop()}},{key:"track",value:function(e){this.staleVideo?this.eventQueue.shift(e):d(p(_.prototype),"track",this).call(this,e)}},{key:"relatedVideoStart",value:function(){this.videoIndex=this.videoIndex+1,this.resetState(),this.setVideoByYoutubeId(this.youtubeId)}},{key:"setVideoByYoutubeId",value:function(e){var t=this;this.staleVideo=!0;var i=new XMLHttpRequest;i.open("GET","/api/videos/by_platform_id/youtube/"+e,!0),i.onload=function(){200===i.status?t.video=JSON.parse(i.responseText):t.video=t.getNonVolumeRelatedVideo()},i.onerror=function(){t.video=t.getNonVolumeRelatedVideo()},i.onloadend=function(){t.staleVideo=!1,Object(o.e)("SENDING "+t.eventQueue.length+" queued events."),t.eventQueue.forEach((function(e){return t.track(e)})),t.eventQueue.length=0,t.track({action:a.a.START,value:t.duration(),index:t.videoIndex})},i.send()}},{key:"getNonVolumeRelatedVideo",value:function(){return{id:0,title_short:this.player.getVideoData().title,description_short:this.player.getVideoData().description,youtube_id:this.player.getVideoData().video_id}}},{key:"duration",value:function(){return this.player?this.player.getDuration():0}},{key:"percentComplete",value:function(){return this.player?this.player.getCurrentTime()/this.duration()*100:0}},{key:"quartileValue",value:function(){var e=this.duration()/4;return e>1?Math.floor(e):Object(o.c)(e)}},{key:"trackQuartiles",value:function(){var e=this.percentComplete();e>=75&&2===this.currentQuartile?(this.currentQuartile=3,this.track({action:a.a.THIRD_QUARTILE,value:this.quartileValue(),index:this.videoIndex})):e>=50&&1===this.currentQuartile?(this.currentQuartile=2,this.track({action:a.a.SECOND_QUARTILE,value:this.quartileValue(),index:this.videoIndex})):e>=25&&0===this.currentQuartile&&(this.currentQuartile=1,this.track({action:a.a.FIRST_QUARTILE,value:this.quartileValue(),index:this.videoIndex}))}},{key:"trackThresholds",value:function(){this.currentThreshold<3&&this.watchedSeconds>=3&&(this.currentThreshold=3,this.track({action:a.a.THREE_SECONDS,value:3,index:this.videoIndex})),this.currentThreshold<10&&this.watchedSeconds>=10&&(this.currentThreshold=10,this.track({action:a.a.TEN_SECONDS,value:10,index:this.videoIndex})),this.currentThreshold<30&&this.watchedSeconds>=30&&(this.currentThreshold=30,this.track({action:a.a.THIRTY_SECONDS,value:30,index:this.videoIndex}))}},{key:"play",value:function(){this.player&&this.player.playVideo()}},{key:"pause",value:function(){this.player&&this.player.stopVideo()}},{key:"destroy",value:function(){this.player&&this.player.destroy()}},{key:"unmute",value:function(){this.player&&this.player.unMute()}}])&&u(i.prototype,n),b&&u(i,b),_}(n.a);function T(e,t){var i={verge:["txJFU9DgUhfr2J2bveCHkQ"],"vrg-sci":["ddiUEpeqJcYeBxX1IVBKvQ"],polygon:["Dqau170byfm1ksTQ0jYNpg"],"polygon-guides":["uVxaQDraOja6xKidcmoufA"]};"UC"===t.substring(0,2)&&(t=t.substring(2));var n=[t];return e in i&&(n=n.concat(i[e])),n}t.default=b}}]);
//# sourceMappingURL=embed-youtube-c3e70f0073a7bd27a97e.chunk.js.map